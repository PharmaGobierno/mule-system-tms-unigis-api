<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:validation="http://www.mulesoft.org/schema/mule/validation" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd">
	<sub-flow name="orchestrator-create-client-order-main" doc:id="cca775ca-1964-48f9-a014-0fb6a2210e28" >
		<flow-ref doc:name="orchestrator-create-client-order-prepare-xml-request" doc:id="b10abb58-3f9c-4140-9af4-879a13358ed2" name="orchestrator-create-client-order-prepare-xml-request"/>
		<flow-ref doc:name="orchestrator-create-client-order-validate-system-source" doc:id="8a90ea90-4095-4b45-be92-c5eada656dc1" name="orchestrator-create-client-order-validate-system-source"/>
		<flow-ref doc:name="orchestrator-create-client-order-prepare-response" doc:id="842797fa-b7e6-4c6a-8cbd-f50d739124b2" name="orchestrator-create-client-order-prepare-response"/>
		<flow-ref doc:name="orchestrator-create-client-order-validate-error" doc:id="fe19ff32-7b1a-4ff3-9c86-3c296ee51691" name="orchestrator-create-client-order-validate-error"/>
	</sub-flow>
	<sub-flow name="orchestrator-create-client-order-prepare-xml-request" doc:id="ab6482c9-6474-4f04-a6a8-0d0ac144a661" >
		<ee:transform doc:name="Transform Message" doc:id="f99cb1b0-2b1a-4370-a23c-a8d21d1de72e" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/xml
ns unis http://unisolutions.com.ar/
---
 {
      unis#"CrearClientesDadores": {
        unis#"apiKey": p('tms.unigis.api.key'),
        unis#"clientes": {
          unis#"pClienteDador": {
            unis#"ReferenciaExterna": payload.referencia_externa,
            unis#"RazonSocial": payload.razon_social,
            unis#"NombreFantasia": payload.nombre_fantasia,
            unis#"Cuit": payload.cuit,
            unis#"Telefono1": payload.telefono1,
            unis#"Telefono2": payload.telefono2,
            unis#"Direccion": payload.direccion,
            unis#"Localidad": payload.localidad,
            unis#"eMailGestorDeFlota": payload.email_gestor_flota,
            unis#"CentroDeCosto": payload.centro_Costo,
            unis#"operaciones": {
              unis#"pOperacion": {
                unis#"Descripcion": payload.operacion.descripcion,
                unis#"IdOperacion": payload.operacion.id_operacion,
                unis#"Referencia": payload.operacion.referencia,
                unis#"Sucursal": payload.operacion.sucursal,
                unis#"ReferenciaExterna": payload.operacion.referencia_externa
              }
            },
            unis#"IdEstado": payload.id_estado
          }
        }
      }
    }]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger" doc:id="a59a7f4d-35fe-4d83-9140-27ed04d2e4e8" message="#[payload]" />
	</sub-flow>
	<sub-flow name="orchestrator-create-client-order-validate-system-source" doc:id="1be8ad0e-f3d8-42ba-a5da-3bdd035271a6" >
		<choice doc:name="Choice" doc:id="0f19e974-354a-44cb-9eda-ce544d18b09f" >
			<when expression='#[vars.source_system == "VMODAL"]'>
				<logger level="INFO" doc:name="Logger" doc:id="c56a95fc-2650-4798-b512-74d463630bc2" message="VMODAL"/>
				<flow-ref doc:name="client-create-order-shipment-call-ws-create-client-order-vmodal" doc:id="6ad0b7b2-1719-4ba5-9d71-c507ea64e65c" name="client-create-order-shipment-call-ws-create-client-order-vmodal"/>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="Logger" doc:id="b9973f36-d33d-4b4d-838b-1940a6a5ef32" message="MEDISTIK"/>
				<flow-ref doc:name="client-create-order-shipment-call-ws-create-client-order-medistik" doc:id="20931473-4dc2-40e7-bb4a-a57f26a6fdf9" name="client-create-order-shipment-call-ws-create-client-order-medistik"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="orchestrator-create-client-order-prepare-response" doc:id="1a5aa333-ee57-4c21-86af-be93ae7343bc" >
		<ee:transform doc:name="Transform Message" doc:id="00fb575e-9c5f-4999-b504-d598ce699705" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger" doc:id="bf48a497-affe-4e64-b3ef-bf7ea4dca9e7" message="#[payload]"/>
	</sub-flow>
	<sub-flow name="orchestrator-create-client-order-validate-error" doc:id="f1e6f680-f565-4042-941b-76d3b6192d43" >
		<ee:transform doc:name="Transform Message" doc:id="65e56a8f-4cfd-4693-92fa-0c756901b428">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="error_messages"><![CDATA[%dw 2.0
import modules::code_errors_unigis
output application/json
---
write(code_errors_unigis::error(payload.body.CrearClientesDadoresResponse.CrearClientesDadoresResult))]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<validation:is-true doc:name="Is true" doc:id="4661875c-fe9e-4bf0-949d-5168b7b93bce" expression="#[(payload.body.CrearClientesDadoresResponse.CrearClientesDadoresResult default 0 ) as Number  &gt; 1]" message="#[vars.error_messages as String]">
			<error-mapping sourceType="VALIDATION:INVALID_BOOLEAN" targetType="UNIGIS:BAD_REQUEST" />
		</validation:is-true>
	</sub-flow>
</mule>
