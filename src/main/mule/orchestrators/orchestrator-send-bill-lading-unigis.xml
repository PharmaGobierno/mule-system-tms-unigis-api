<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="orchestrator-send-bill-lading-unigis" doc:id="a6c1fa88-fb07-48e4-86a8-5c20d0b1e32d" >
		<flow-ref doc:name="Call-orchestrator-prepare-xml-request-send-bill-lading-unigis-documents" doc:id="8b2f7536-377d-445a-a045-f11e631b12aa" name="orchestrator-prepare-xml-request-send-bill-lading-unigis-documents"/>
		<flow-ref doc:name="Call-orchestrator-send-bill-lading-unigis-validate-source-system" doc:id="b79cc3cd-e39a-4efc-ae40-c367d2d055b5" name="orchestrator-send-bill-lading-unigis-validate-source-system"/>
		<flow-ref doc:name="Call-orchestrator-send-bill-lading-unigis-prepare-response-for-sending-documents" doc:id="c1f066a4-9bab-405e-8aad-f71daafd3d8b" name="orchestrator-send-bill-lading-unigis-prepare-response-for-sending-documents"/>
	</sub-flow>
	<sub-flow name="orchestrator-prepare-xml-request-send-bill-lading-unigis-documents" doc:id="9965e6cf-3a62-4958-a5e0-64a2aa6b4942" >
		<ee:transform doc:name="Set request for pdf document" doc:id="430125ca-f142-4d93-bd1d-fbad33311767" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
ns unis http://unisolutions.com.ar/
output application/xml
---
{
  unis#"CrearDocumentos": {
    unis#"ApiKey": p('tms.unigis.api.key'),
    unis#"Documentos": {
      unis#"pDocumento": {
        unis#"TipoDocumento": payload.crearDocumentos.Documentos.pDocumento.tipoDocumento,
        unis#"Referencia": payload.crearDocumentos.Documentos.pDocumento.referencia,
        unis#"FechaEmision": payload.crearDocumentos.Documentos.pDocumento.fechaEmision,
        unis#"FechaExpiracion": payload.crearDocumentos.Documentos.pDocumento.fechaExpiracion,
        unis#"Categoria": payload.crearDocumentos.Documentos.pDocumento.categoria,
        unis#"Clase": payload.crearDocumentos.Documentos.pDocumento.clase,
        unis#"Observaciones": payload.crearDocumentos.Documentos.pDocumento.observaciones,
        unis#"ReferenciaEstadoDocumento": payload.crearDocumentos.Documentos.pDocumento.referenciaEstadoDocumento,
        unis#"ForzarActualizacion": payload.crearDocumentos.Documentos.pDocumento.forzarActualizacion,
        unis#"Asociaciones": {
          unis#"ReferenciaViaje": payload.crearDocumentos.Documentos.pDocumento.asociaciones.referenciaViaje
        },
        unis#"ArchivosAsociados": {
          unis#"pArchivoDoc": {
            unis#"Descripcion": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.descripcion,
            unis#"TipoArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo,
            unis#"Contenido": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.contenido,
            unis#"ClasificacionArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.clasificacionArchivo
          }
        },
        unis#"CrearDocumentoRequeridoViaje": payload.crearDocumentos.Documentos.pDocumento.crearDocumentoRequeridoViaje,
        unis#"IdViaje": payload.crearDocumentos.Documentos.pDocumento.idViaje,
        unis#"EsDocumentoRequerido": payload.crearDocumentos.Documentos.pDocumento.esDocumentoRequerido
      }
    }
  }
}]]></ee:set-payload>
			</ee:message>
			<ee:variables />
		</ee:transform>
	</sub-flow>
	<!-- [STUDIO:"orchestrator-prepare-xml-request-send-bill-lading-unigis-documents"]<sub-flow name="orchestrator-prepare-xml-request-send-bill-lading-unigis-documents" doc:id="82237174-6579-4c50-bca6-2f335c08365e" >
		<ee:transform doc:name="Define type document request xml or pdf" doc:id="373a75ac-f72c-4a5d-aa6e-18dfd1af9aff">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
ns unis http://unisolutions.com.ar/
output application/xml
&#45;&#45;-
	if ( payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo == ".PDF" ) {
	unis#"CrearDocumentos": {
		unis#"ApiKey": payload.crearDocumentos.apiKey,
		unis#"Documentos": {
			unis#"pDocumento": {
				unis#"TipoDocumento": payload.crearDocumentos.Documentos.pDocumento.tipoDocumento,
				unis#"Referencia": payload.crearDocumentos.Documentos.pDocumento.referencia,
				unis#"FechaEmision": payload.crearDocumentos.Documentos.pDocumento.fechaEmision,
				unis#"FechaExpiracion": payload.crearDocumentos.Documentos.pDocumento.fechaExpiracion,
				unis#"Categoria": payload.crearDocumentos.Documentos.pDocumento.categoria,
				unis#"Clase": payload.crearDocumentos.Documentos.pDocumento.clase,
				unis#"Observaciones": payload.crearDocumentos.Documentos.pDocumento.observaciones,
				unis#"ReferenciaEstadoDocumento": payload.crearDocumentos.Documentos.pDocumento.referenciaEstadoDocumento,
				unis#"ForzarActualizacion": payload.crearDocumentos.Documentos.pDocumento.forzarActualizacion,
				unis#"Asociaciones": {
					unis#"ReferenciaViaje": payload.crearDocumentos.Documentos.pDocumento.asociaciones.referenciaViaje
				},
				unis#"ArchivosAsociados": {
					unis#"pArchivoDoc": {
						unis#"Descripcion": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.descripcion,
						unis#"TipoArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo,
						unis#"Contenido": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.contenido,
						unis#"ClasificacionArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.clasificacionArchivo
					}
				},
				unis#"CrearDocumentoRequeridoViaje": payload.crearDocumentos.Documentos.pDocumento.crearDocumentoRequeridoViaje,
				unis#"IdViaje": payload.crearDocumentos.Documentos.pDocumento.idViaje,
				unis#"EsDocumentoRequerido": payload.crearDocumentos.Documentos.pDocumento.esDocumentoRequerido
			}
		}
	}
}
else if ( payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo == ".XML" ) {
	unis#"CrearDocumentos": {
		unis#"ApiKey": payload.crearDocumentos.apiKey,
		unis#"Documentos": {
			unis#"pDocumento": {
				unis#"TipoDocumento": payload.crearDocumentos.Documentos.pDocumento.tipoDocumento,
				unis#"Referencia": payload.crearDocumentos.Documentos.pDocumento.referencia,
				unis#"FechaEmision": payload.crearDocumentos.Documentos.pDocumento.fechaEmision,
				unis#"FechaExpiracion": payload.crearDocumentos.Documentos.pDocumento.fechaExpiracion,
				unis#"Categoria": payload.crearDocumentos.Documentos.pDocumento.categoria,
				unis#"Clase": payload.crearDocumentos.Documentos.pDocumento.clase,
				unis#"Observaciones": payload.crearDocumentos.Documentos.pDocumento.observaciones,
				unis#"ReferenciaEstadoDocumento": payload.crearDocumentos.Documentos.pDocumento.referenciaEstadoDocumento,
				unis#"ForzarActualizacion": payload.crearDocumentos.Documentos.pDocumento.forzarActualizacion,
				unis#"Asociaciones": {
					unis#"ReferenciaViaje": payload.crearDocumentos.Documentos.pDocumento.asociaciones.referenciaViaje
				},
				unis#"ArchivosAsociados": {
					unis#"pArchivoDoc": {
						unis#"Descripcion": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.descripcion,
						unis#"TipoArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo,
						unis#"Contenido": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.contenido,
						unis#"ClasificacionArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.clasificacionArchivo
					}
				},
				unis#"CrearDocumentoRequeridoViaje": payload.crearDocumentos.Documentos.pDocumento.crearDocumentoRequeridoViaje,
				unis#"IdViaje": payload.crearDocumentos.Documentos.pDocumento.idViaje,
				unis#"EsDocumentoRequerido": payload.crearDocumentos.Documentos.pDocumento.esDocumentoRequerido
			}
		}
	}
}
else
""&#93;&#93;></ee:set-payload>
			</ee:message>
		</ee:transform>
		<choice doc:name="Choice" doc:id="5afef839-c270-472f-9ef3-a75baf14fbe9" >
			<when expression='#[payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo == ".PDF"&#93;'>
				<ee:transform doc:name="Set request for pdf document" doc:id="0166a84d-f6d0-48d7-829a-a5a783b776ce">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
ns unis http://unisolutions.com.ar/
output application/xml  
&#45;&#45;-
{
  unis#"CrearDocumentos": {
    unis#"ApiKey": p('tms.unigis.api.key'),
    unis#"Documentos": {
      unis#"pDocumento": {
        unis#"TipoDocumento": payload.crearDocumentos.Documentos.pDocumento.tipoDocumento,
        unis#"Referencia": payload.crearDocumentos.Documentos.pDocumento.referencia,
        unis#"FechaEmision": payload.crearDocumentos.Documentos.pDocumento.fechaEmision,
        unis#"FechaExpiracion": payload.crearDocumentos.Documentos.pDocumento.fechaExpiracion,
        unis#"Categoria": payload.crearDocumentos.Documentos.pDocumento.categoria,
        unis#"Clase": payload.crearDocumentos.Documentos.pDocumento.clase,
        unis#"Observaciones": payload.crearDocumentos.Documentos.pDocumento.observaciones,
        unis#"ReferenciaEstadoDocumento": payload.crearDocumentos.Documentos.pDocumento.referenciaEstadoDocumento,
        unis#"ForzarActualizacion": payload.crearDocumentos.Documentos.pDocumento.forzarActualizacion,
        unis#"Asociaciones": {
          unis#"ReferenciaViaje": payload.crearDocumentos.Documentos.pDocumento.asociaciones.referenciaViaje
        },
        unis#"ArchivosAsociados": {
          unis#"pArchivoDoc": {
            unis#"Descripcion": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.descripcion,
            unis#"TipoArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo,
            unis#"Contenido": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.contenido,
            unis#"ClasificacionArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.clasificacionArchivo
          }
        },
        unis#"CrearDocumentoRequeridoViaje": payload.crearDocumentos.Documentos.pDocumento.crearDocumentoRequeridoViaje,
        unis#"IdViaje": payload.crearDocumentos.Documentos.pDocumento.idViaje,
        unis#"EsDocumentoRequerido": payload.crearDocumentos.Documentos.pDocumento.esDocumentoRequerido
      }
    }
  }
}&#93;&#93;></ee:set-payload>
			</ee:message>
			<ee:variables>
			</ee:variables>
		</ee:transform>
			</when>
			<when expression='#[payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo == ".XML"&#93;'>
				<ee:transform doc:name="Set request for xml document" doc:id="ee0359be-7aa6-44cc-9951-372de4f2d773">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
ns unis http://unisolutions.com.ar/
output application/xml  
&#45;&#45;-
{
  unis#"CrearDocumentos": {
    unis#"ApiKey": p('tms.unigis.api.key'),
    unis#"Documentos": {
      unis#"pDocumento": {
        unis#"TipoDocumento": payload.crearDocumentos.Documentos.pDocumento.tipoDocumento,
        unis#"Referencia": payload.crearDocumentos.Documentos.pDocumento.referencia,
        unis#"FechaEmision": payload.crearDocumentos.Documentos.pDocumento.fechaEmision,
        unis#"FechaExpiracion": payload.crearDocumentos.Documentos.pDocumento.fechaExpiracion,
        unis#"Categoria": payload.crearDocumentos.Documentos.pDocumento.categoria,
        unis#"Clase": payload.crearDocumentos.Documentos.pDocumento.clase,
        unis#"Observaciones": payload.crearDocumentos.Documentos.pDocumento.observaciones,
        unis#"ReferenciaEstadoDocumento": payload.crearDocumentos.Documentos.pDocumento.referenciaEstadoDocumento,
        unis#"ForzarActualizacion": payload.crearDocumentos.Documentos.pDocumento.forzarActualizacion,
        unis#"Asociaciones": {
          unis#"ReferenciaViaje": payload.crearDocumentos.Documentos.pDocumento.asociaciones.referenciaViaje
        },
        unis#"ArchivosAsociados": {
          unis#"pArchivoDoc": {
            unis#"Descripcion": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.descripcion,
            unis#"TipoArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.tipoArchivo,
            unis#"Contenido": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.contenido,
            unis#"ClasificacionArchivo": payload.crearDocumentos.Documentos.pDocumento.archivosAsociados.pArchivoDoc.clasificacionArchivo
          }
        },
        unis#"CrearDocumentoRequeridoViaje": payload.crearDocumentos.Documentos.pDocumento.crearDocumentoRequeridoViaje,
        unis#"IdViaje": payload.crearDocumentos.Documentos.pDocumento.idViaje,
        unis#"EsDocumentoRequerido": payload.crearDocumentos.Documentos.pDocumento.esDocumentoRequerido
      }
    }
  }
}&#93;&#93;></ee:set-payload>
			</ee:message>
			<ee:variables>
			</ee:variables>
		</ee:transform>
			</when>
			<otherwise >
				<logger level="INFO" doc:name="Logger" doc:id="52461ebe-d5d9-45f7-824a-e09950848a14" message="#[payload&#93;"/>
			</otherwise>
		</choice>
	</sub-flow> [STUDIO] -->
	<sub-flow name="orchestrator-send-bill-lading-unigis-validate-source-system" doc:id="a5778f8a-5ac6-4938-952b-0e2eac989b92" >
		<choice doc:name="Choice" doc:id="9a2a83cd-aeb2-4122-bb59-04ddeb1486ac" >
			<when expression='#[vars.source_system == "MD"]'>
				<flow-ref doc:name="Call-client-ws-unigis-medistik-send-document-pdf-and-xml" doc:id="d0ea49ab-1ddc-44d8-b29b-ab4732b3fe59" name="client-ws-unigis-medistik-send-document-pdf-and-xml"/>
			</when>
			<when expression='#[vars.source_system == "VM"]'>
				<flow-ref doc:name="Call-client-ws-unigis-vmodal-send-document-pdf-and-xml" doc:id="6d3fbc1a-6c48-49b8-96bd-db98724fa4f2" name="client-ws-unigis-vmodal-send-document-pdf-and-xml" />
			</when>
			<otherwise>
				<logger level="INFO" doc:name="Logger" doc:id="dee21c56-a1a7-46bc-a585-cd6cbb603304" message="#[payload]"/>
			</otherwise>
		</choice>
	</sub-flow>
	<sub-flow name="orchestrator-send-bill-lading-unigis-prepare-response-for-sending-documents" doc:id="dcfc898d-6d31-4780-a1e9-575a2f9987fc" >
		<ee:transform doc:name="Set final response" doc:id="cac334f8-97cc-4571-a3bf-649a9d8b7b58" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger" doc:id="b03cf1c3-94c1-4c2e-b6a2-5022e8635cbe" message="#[payload]"/>
	</sub-flow>
</mule>
