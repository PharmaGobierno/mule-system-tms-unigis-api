<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="orchestrator-create-order-shipment-main" doc:id="02516b96-d24b-4de4-bf0a-e72396d59de0" >
		<flow-ref doc:name="orchestrator-create-order-shipment-prepare-request" doc:id="f5aedb2f-3514-4145-b695-52380721f959" name="orchestrator-create-order-shipment-prepare-request"/>
		<flow-ref doc:name="client-create-order-shipment-call-ws-create-order-shipment" doc:id="1fbf546b-1a4a-41bd-bc5c-f81ef1df44aa" name="client-create-order-shipment-call-ws-create-order-shipment"/>
		<flow-ref doc:name="call-orchestrator-set-response" doc:id="325963b7-0531-4190-bb20-d9c0553d04a2" name="orchestrator-set-response"/>
	</sub-flow>
	<sub-flow name="orchestrator-create-order-shipment-prepare-request" doc:id="f8e7152d-6e4a-4893-a746-b58ec72bae7d" >
		<ee:transform doc:name="Transform Message" doc:id="82b15b01-906d-4f25-9e02-604b8facd06f" >
			<ee:message >
				<ee:set-payload ><![CDATA[  %dw 2.0
output application/xml
ns unis http://unisolutions.com.ar/
---
{
	unis#CrearOrdenesEntrega: {
		unis#apiKey: "24-11-5E-6F-5A-6",
		unis#entregas:  {
            unis#pOrdenEntrega:{
                unis#Sucursal: "AVIOR-27",
                unis#Operacion: "S-ORDI",
                unis#RefDocumento: payload.processShipmentOrderCreate.Shipment.ShipmentNumber,
                unis#RefDocumentoAdicional: payload.processShipmentOrderCreate.Shipment.ShipmentDescription,
                unis#Tipo: "No Determinado",
                unis#Estado: "Inicial",
                unis#FechaJornada: payload.processShipmentOrderCreate.Shipment.PickupFromDateTime,
                unis#Cliente:{
                    unis#RefCliente: payload.processShipmentOrderCreate.Shipment.ShipToLocationCode,
                    unis#RazonSocial: "",
                    unis#Telefono: "",
                    unis#EMail: "",
                    unis#Direccion: "",
                    unis#Calle: "",
                    unis#NumeroPuerta: "",
                    unis#Barrio: "",
                    unis#Localidad: "",
                    unis#Partido: "",
                    unis#Provincia: "",
                    unis#Pais: "",
                    unis#Latitud: "19.4368",
                    unis#Longitud: "-99.0711",
                    unis#RefDomicilioExterno: "",
                    unis#DomicilioDescripcion: "",
                    unis#Varchar1: "",
                    unis#Varchar2: "",
                    unis#Contacto: "",
                    unis#Int1: -1,
                    unis#Int2: -1,
                    unis#Float1: -1,
                    unis#Float2: -1,
                    unis#CargaExclusiva: false,
                    unis#IgnorarOperacion: false,
                    unis#IgnorarOperacionDomicilioOrden: true,
                    unis#CrearDomicilioOrden: true,
                    unis#ActualizarDomicilioOrden: true,
                    unis#ValidarDomicilioOrden: false
                },
                unis#Descripcion: "",
                unis#Direccion: "",
                unis#Calle: "",
                unis#NroPuerta: "",
                unis#Barrio: "",
                unis#Localidad: "",
                unis#Partido: "",
                unis#Provincia: "",
                unis#Pais: "",
                unis#Observaciones: "",
                unis#Email: "",
                unis#Telefono: "",
                unis#Varchar1: "",
                unis#Varchar2: "",
                unis#Varchar3: "",
                unis#Varchar4: "",
                unis#Int1: "-1",
                unis#Int2: "-1",
                unis#GrupoRutas: 1,
                unis#DepositoSalida: {
                    unis#RefDepositoExterno: "AVIOR-27",
                    unis#Descripcion: "AVIOR-27",
                    unis#Direccion: "Carretera, Jorobas - Tula, KM 5, CP. 54680, Santa Teresa, Méx.",
                    unis#NroPuerta: "",
                    unis#Ciudad: "",
                    unis#Municipio: "",
                    unis#Colonia: "",
                    unis#InicioHorario: "0",
                    unis#FinHorario: "2359",
                    unis#TiempoEspera: "10",
                    unis#Latitud: "19.870021",
                    unis#Longitud: "-99.2348441",
                    unis#Calle: "",
                    unis#Barrio: "",
                    unis#Localidad: "",
                    unis#Partido: "",
                    unis#Provincia: "Estado de Mexico",
                    unis#Pais: "MEXICO",
                    unis#Eliminado: false
                },
                unis#DepositoLlegada: {
                    unis#RefDepositoExterno: "AVIOR-27",
                    unis#Descripcion: "AVIOR-27",
                    unis#Direccion: "Carretera, Jorobas - Tula, KM 5, CP. 54680, Santa Teresa, Méx.",
                    unis#NroPuerta: "",
                    unis#Ciudad: "",
                    unis#Municipio: "",
                    unis#Colonia: "",
                    unis#InicioHorario: "0",
                    unis#FinHorario: "2359",
                    unis#TiempoEspera: "10",
                    unis#Latitud: "19.870021",
                    unis#Longitud: "-99.2348441",
                    unis#Calle: "",
                    unis#Barrio: "",
                    unis#Localidad: "",
                    unis#Partido: "",
                    unis#Provincia: "Estado de Mexico",
                    unis#Pais: "MEXICO",
                    unis#Eliminado: false
                },
                unis#Items: {
                    unis#pOrdenEntregaItem: {
                        unis#RefDocumento: "0X00000XXX",
                        unis#Descripcion: "Medicamento",
                        unis#RefDocumentoAdicional: "0X00000XXX",
                        unis#Producto:{
                            unis#RefProducto:"0X00000XXX",
                            unis#Descripcion:"Medicamento",
                            unis#Volumen:"1",
                            unis#Peso:"4",
                            unis#Bultos:"1",
                            unis#Alto:"1",
                            unis#Ancho:"1",
                            unis#Profundidad:"1",
                            unis#Apilable:"1",
                            unis#Rotacion:"V",
                            unis#Codigo:"0X00000XXX",
                            unis#RazonSocial:"cliente ECATEPEC",
                            unis#RotacionesPermitidas:"3",
                            unis#Linea:"Tabletas",
                            unis#SubLinea:"Capsulas",
                            unis#UnidadMedida:"m",
                            unis#TiempoDescarga:"15",
                            unis#Ordenamiento:"-1"
                        },
                        unis#Cantidad:"10",
                        unis#Volumen:"1",
                        unis#Peso:"4",
                        unis#Bulto:"10",
                        unis#Varchar1:"",
                        unis#Varchar2:"",
                        unis#LPN:"",
                        unis#Unidades:"-1",
                        unis#Int1:"-1",
                        unis#Int2:"-1",
                        unis#ReferenciaCantidad:"-1",
                        unis#ReferenciaValor:"-1",
                        unis#ProcesarVolumetria:true
                    },
                    unis#pOrdenEntregaItem: {
                        unis#RefDocumento: "0X00000XXXXX",
                        unis#Descripcion: "Medicamento 2",
                        unis#RefDocumentoAdicional: "0X00000XXXXX",
                        unis#Producto:{
                            unis#RefProducto:"0X00000XXXXX",
                            unis#Descripcion:"Medicamento 2",
                            unis#Volumen:"1",
                            unis#Peso:"4",
                            unis#Bultos:"1",
                            unis#Alto:"1",
                            unis#Ancho:"1",
                            unis#Profundidad:"1",
                            unis#Apilable:"1",
                            unis#Rotacion:"V",
                            unis#Codigo:"0X00000XXXXX",
                            unis#RazonSocial:"cliente ECATEPEC",
                            unis#RotacionesPermitidas:"3",
                            unis#Linea:"Tabletas",
                            unis#SubLinea:"Capsulas",
                            unis#UnidadMedida:"m",
                            unis#TiempoDescarga:"15",
                            unis#Ordenamiento:"-1"
                        },
                        unis#Cantidad:"10",
                        unis#Volumen:"1",
                        unis#Peso:"4",
                        unis#Bulto:"10",
                        unis#Varchar1:"",
                        unis#Varchar2:"",
                        unis#LPN:"",
                        unis#Unidades:"-1",
                        unis#Int1:"-1",
                        unis#Int2:"-1",
                        unis#ReferenciaCantidad:"-1",
                        unis#ReferenciaValor:"-1",
                        unis#ProcesarVolumetria:true
                    }
                },
                unis#usarProductos:false,
                unis#Fecha:payload.processShipmentOrderCreate.Shipment.PickupToDateTime[0 to 9],
                unis#FechaOrden:payload.processShipmentOrderCreate.Shipment.DeliveryToDateTime[0 to 9],
                unis#Unidades:"-1"
            }
        }
	}
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	<sub-flow name="orchestrator-set-response" doc:id="ce4affd3-51b2-4f26-9c1b-ded0bc8b726e" >
		<ee:transform doc:name="Transform Message" doc:id="5c7701b0-aae8-469a-ac04-0de64614da48" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
if (payload.Body.CrearOrdenesEntregaResponse.CrearOrdenesEntregaResult as Number == 1)
	{
    "traxion_response": {
        "completed_succesfully": "true",
        "response": {
            "message": "successful",
            "data": {}
        }
    }
}
else
	{
    "traxion_response": {
        "completed_succesfully": "false",
        "response": {
            "message": "Soap error",
            "data": {}
        }
    }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
