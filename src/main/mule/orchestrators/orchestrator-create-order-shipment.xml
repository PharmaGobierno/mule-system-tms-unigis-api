<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="orchestrator-create-order-shipment-main" doc:id="02516b96-d24b-4de4-bf0a-e72396d59de0" >
		<flow-ref doc:name="orchestrator-create-order-shipment-prepare-request" doc:id="f5aedb2f-3514-4145-b695-52380721f959" name="orchestrator-create-order-shipment-prepare-request"/>
		<flow-ref doc:name="client-create-order-shipment-call-ws-create-order-shipment" doc:id="1fbf546b-1a4a-41bd-bc5c-f81ef1df44aa" name="client-create-order-shipment-call-ws-create-order-shipment"/>
		<flow-ref doc:name="call-orchestrator-set-response" doc:id="325963b7-0531-4190-bb20-d9c0553d04a2" name="orchestrator-set-response"/>
	</sub-flow>
	<sub-flow name="orchestrator-create-order-shipment-prepare-request" doc:id="f8e7152d-6e4a-4893-a746-b58ec72bae7d" >
		<ee:transform doc:name="Transform Message" doc:id="82b15b01-906d-4f25-9e02-604b8facd06f" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/xml
ns unis http://unisolutions.com.ar/
---
{
    unis#CrearOrdenesEntrega: {
        unis#apiKey: payload.CrearOrdenesEntrega.apiKey,
        unis#entregas:  {
            unis#pOrdenEntrega:{
                unis#Sucursal: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Sucursal,
                unis#Operacion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Operacion,
                unis#RefDocumento: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega..RefDocumento,
                unis#RefDocumentoAdicional: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.RefDocumentoAdicional,
                unis#Tipo: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Tipo,
                unis#Estado: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Estado,
                unis#FechaJornada: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.FechaJornada,
                unis#Cliente:{
                    unis#RefCliente:  payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.RefCliente,
                    unis#RazonSocial: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.RazonSocial,
                    unis#Telefono: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Telefono,
                    unis#EMail: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.EMail,
                    unis#Direccion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Direccion,
                    unis#Calle: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Calle,
                    unis#NumeroPuerta: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.NumeroPuerta,
                    unis#Barrio: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Barrio,
                    unis#Localidad: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Localidad,
                    unis#Partido: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Partido,
                    unis#Provincia: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Provincia,
                    unis#Pais: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Pais,
                    unis#Latitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Latitud,
                    unis#Longitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Longitud,
                    unis#RefDomicilioExterno: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.RefDomicilioExterno,
                    unis#DomicilioDescripcion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.DomicilioDescripcion,
                    unis#InicioHorario1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.InicioHorario1,
                    unis#FinHorario1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.FinHorario1,
                    unis#TiempoEspera: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.TiempoEspera,
                    unis#Varchar1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Varchar1,
                    unis#Varchar2: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Varchar2,
                    unis#Contacto: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Contacto,
                    unis#Int1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Int1,
                    unis#Int2: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Int2,
                    unis#Float1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Float1,
                    unis#Float2: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.Float2,
                    unis#CargaExclusiva: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.CargaExclusiva,
                    unis#IgnorarOperacion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.IgnorarOperacion,
                    unis#IgnorarOperacionDomicilioOrden: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.IgnorarOperacionDomicilioOrden,
                    unis#CrearDomicilioOrden: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.CrearDomicilioOrden,
                    unis#ActualizarDomicilioOrden: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.ActualizarDomicilioOrden,
                    unis#ValidarDomicilioOrden: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Cliente.ValidarDomicilioOrden
                },
                unis#Descripcion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Descripcion,
                unis#Direccion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Direccion,
                unis#Calle: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Calle,
                unis#NroPuerta: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.NroPuerta,
                unis#Barrio: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Barrio,
                unis#Localidad: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Localidad,
                unis#Partido: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Partido,
                unis#Provincia: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Provincia,
                unis#Pais: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Pais,
                unis#InicioHorario1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.InicioHorario1,
                unis#FinHorario1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.FinHorario1,
                unis#TiempoEspera: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.TiempoEspera,
                unis#CrearDomicilio: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.CrearDomicilio,
                unis#Volumen: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Volumen,
                unis#Peso: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Peso,
                unis#Bulto: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Bulto,
                unis#Pallets: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Pallets,
                unis#Latitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Latitud,
                unis#Longitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Longitud,
                unis#Observaciones: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Observaciones,
                unis#Email: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Email,
                unis#Telefono: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Telefono,
                unis#Varchar1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Varchar1,
                unis#Varchar2: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Varchar2,
                unis#Varchar3: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Varchar3,
                unis#Varchar4: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Varchar4,
                unis#Int1: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Int1,
                unis#Int2: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Int2,
                unis#GrupoRutas: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.GrupoRutas,
                unis#DepositoSalida: {
                    unis#RefDepositoExterno: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.RefDepositoExterno,
                    unis#Descripcion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Descripcion,
                    unis#Direccion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Direccion,
                    unis#NroPuerta: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.NroPuerta,
                    unis#Ciudad: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Ciudad,
                    unis#Municipio: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Municipio,
                    unis#Colonia: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Colonia,
                    unis#InicioHorario: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.InicioHorario,
                    unis#FinHorario: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.FinHorario,
                    unis#TiempoEspera: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.TiempoEspera,
                    unis#Latitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Latitud,
                    unis#Longitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Longitud,
                    unis#Calle: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Calle,
                    unis#Barrio: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Barrio,
                    unis#Localidad: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Localidad,
                    unis#Partido: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Partido,
                    unis#Provincia: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Provincia,
                    unis#Pais: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Pais,
                    unis#Eliminado: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoSalida.Eliminado
                },
                unis#DepositoLlegada: {
                    unis#RefDepositoExterno: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.RefDepositoExterno,
                    unis#Descripcion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Descripcion,
                    unis#Direccion: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Direccion,
                    unis#NroPuerta: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.NroPuerta,
                    unis#Ciudad: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Ciudad,
                    unis#Municipio: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Municipio,
                    unis#Colonia: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Colonia,
                    unis#InicioHorario: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.InicioHorario,
                    unis#FinHorario: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.FinHorario,
                    unis#TiempoEspera: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.TiempoEspera,
                    unis#Latitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Latitud,
                    unis#Longitud: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Longitud,
                    unis#Calle: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Calle,
                    unis#Barrio: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Barrio,
                    unis#Localidad: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Localidad,
                    unis#Partido: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Partido,
                    unis#Provincia: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Provincia,
                    unis#Pais: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Pais,
                    unis#Eliminado: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.DepositoLlegada.Eliminado
                },
                unis#Items:{
                    unis#pOrdenEntregaItem:  payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Items.*pOrdenEntregaItem map(item)->{
                        unis#RefDocumento: item.RefDocumento,
                        unis#Descripcion: item.Descripcion,
                        unis#RefDocumentoAdicional: item.RefDocumentoAdicional,
                        unis#Producto:{
                            unis#RefProducto: item.Producto.RefProducto,
                            unis#Descripcion: item.Producto.Descripcion,
                            unis#Volumen: item.Producto.Volumen,
                            unis#Peso: item.Producto.Peso,
                            unis#Bultos: item.Producto.Bultos,
                            unis#Alto: item.Producto.Alto,
                            unis#Ancho: item.Producto.Ancho,
                            unis#Profundidad: item.Producto.Profundidad,
                            unis#Apilable: item.Producto.Apilable,
                            unis#Rotacion: item.Producto.Rotacion,
                            unis#Codigo: item.Producto.Codigo,
                            unis#RazonSocial: item.Producto.RazonSocial,
                            unis#RotacionesPermitidas: item.Producto.RotacionesPermitidas,
                            unis#Linea: item.Producto.Linea,
                            unis#SubLinea: item.Producto.SubLinea,
                            unis#UnidadMedida: item.Producto.UnidadMedida,
                            unis#TiempoDescarga: item.Producto.TiempoDescarga,
                            unis#Ordenamiento: item.Producto.Ordenamiento
                        },
                        unis#Cantidad: item.Cantidad,
                        unis#Volumen: item.Volumen,
                        unis#Peso: item.Peso,
                        unis#Bulto: item.Bulto,
                        unis#Varchar1: item.Varchar1,
                        unis#Varchar2: item.Varchar2,
                        unis#LPN: item.LPN,
                        unis#Unidades: item.Unidades,
                        unis#Int1: item.Int1,
                        unis#Int2: item.Int2,
                        unis#ReferenciaCantidad: item.ReferenciaCantidad,
                        unis#ReferenciaValor: item.ReferenciaValor,
                        unis#ProcesarVolumetria: item.ProcesarVolumetria
                    }
                },
                unis#usarProductos: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.usarProductos,
                unis#Fecha: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Fecha,
                unis#FechaOrden: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.FechaOrden,
                unis#Unidades: payload.CrearOrdenesEntrega.entregas.pOrdenEntrega.Unidades
            }
        }
    }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	<sub-flow name="orchestrator-set-response" doc:id="ce4affd3-51b2-4f26-9c1b-ded0bc8b726e" >
		<ee:transform doc:name="Transform Message" doc:id="5c7701b0-aae8-469a-ac04-0de64614da48" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
if (payload.Body.CrearOrdenesEntregaResponse.CrearOrdenesEntregaResult as Number == 1)
	{
    "traxion_response": {
        "completed_succesfully": "true",
        "response": {
            "message": "successful",
            "data": {}
        }
    }
}
else
	{
    "traxion_response": {
        "completed_succesfully": "false",
        "response": {
            "message": "Soap error",
            "data": {}
        }
    }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
