<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:wsc="http://www.mulesoft.org/schema/mule/wsc"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/wsc http://www.mulesoft.org/schema/mule/wsc/current/mule-wsc.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="client-create-order-shipment-call-ws-create-order-shipment-vmodal" doc:id="0774fb6d-c8e4-45c8-b121-2e39f775ab18" >
		<try doc:name="Try" doc:id="e7abda37-652b-43b4-ab12-e663f592c221" >
			<wsc:consume doc:name="Consume" doc:id="930b06fe-6d56-4c02-a31d-3408a14a4247" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="CrearOrdenesEntrega" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="ad577601-5c14-4fcf-a40f-bda470ed4948" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT" >
					<ee:transform doc:name="Transform Message" doc:id="8d8ac748-2f99-4119-b775-78db25bf031a" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="a39b261f-dab6-45d6-8ee9-64e925c280a5" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="23bbb59a-e74a-4a4d-a69d-748c1b5037e6" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="57eb0c9b-c898-4f03-b7a0-c1f4fbd447ba" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>	
	<sub-flow name="client-create-call-ws-create-order-imss" doc:id="606aba2c-e3a1-4fe3-bef9-cf4947876216" >
		<try doc:name="Try" doc:id="a708ae1e-a7bd-4d29-83bc-2246aaf53936" >
			<wsc:consume doc:name="Consume" doc:id="3f10a743-c173-4f87-99f5-500c9fdd5407" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="CrearViajeCompleto">
			<error-mapping targetType="UNIGIS:UNKNOWN_ERROR" />
		</wsc:consume>
			<logger level="INFO" doc:name="Logger" doc:id="8b714fcf-60da-47ae-a927-ced12f356911" message="#[%dw 2.0&#10;output application/json&#10;---&#10;payload]" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="9c045233-13a5-4989-9bb4-fe608e6d877d" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT" >
					<ee:transform doc:name="Transform Message" doc:id="d33a3e9e-ce75-4104-a4df-9b178bd74b7d" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="6c2fdb60-7857-4697-ad16-6564eaebc1da" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="2bb06082-1349-4015-92d0-bdca2a5a8155" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="50dbff48-a1cb-46ca-a1b1-3a39865fbfc7" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="client-create-call-ws-create-shipment-order" doc:id="c84b839c-a78d-4407-89bb-9b04fb8464a1" >
		<try doc:name="Try" doc:id="57bd3bd0-e16f-46a0-896a-dfc852a4d3e2" >
			<wsc:consume doc:name="Consume" doc:id="8cb8d84c-fdf4-4206-8118-637ae46ce423" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="CrearOrdenesPedido">
			<error-mapping targetType="UNIGIS:UNKNOWN_ERROR" />
		</wsc:consume>
			<logger level="INFO" doc:name="Logger" doc:id="d68bcdf1-e914-415d-aa29-f1d0dd501979" message="#[%dw 2.0&#10;output application/json&#10;---&#10;payload]" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="e7d44c9e-67bb-44e6-8177-7d30a6e92a17" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT">
					<ee:transform doc:name="Transform Message" doc:id="2fd148d9-6df5-4a20-acd4-25bf8d77c6a3" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="40bab84a-4666-4d3a-84fe-051bdeb94272" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="3c4543e9-5358-47a7-b6d4-c152768efd70" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="d63a33a2-d53e-49ce-9348-3bcb40da83e8" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>			
	<sub-flow name="client-create-order-shipment-call-ws-create-client-order-vmodal" doc:id="c32d1eef-79ab-4bef-a9a2-1962c7c7e5a9" >
		<try doc:name="Try" doc:id="80279d57-1919-4d75-89bf-eea36a56c5d3" >
			<wsc:consume doc:name="Consume" doc:id="81b69c76-a0f5-46a6-9fd6-146ca002287e" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="CrearClientesDadores" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="8df52956-237e-413a-96da-50d3378eb1d4" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT" >
					<ee:transform doc:name="Transform Message" doc:id="a5447da4-c1b8-4f36-b21e-08fe27e20a6e" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="b1295d23-6e1a-4fdb-a6b7-61cabadbe3c5" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="2df55d9d-918e-4b90-b330-4684cda8c913" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="a84ac210-9691-47b5-b86f-ff85000a93e0" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="client-create-order-shipment-call-ws-create-transportista-vmodal" doc:id="018a2e49-d780-432e-93c8-c6a9f0124e54" >
		<try doc:name="Try" doc:id="584f3feb-7b54-45ad-b18c-51e0055b3e6e" >
			<wsc:consume doc:name="Consume" doc:id="22debefb-f7ac-41c4-a4c3-178c10bf2f4b" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="CrearTransportes" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="46943347-eef3-4872-8eba-4b2236c4c5aa" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT" >
					<ee:transform doc:name="Transform Message" doc:id="f5a58f33-b0e0-4a3a-9f97-19a05f5e3037" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="1fcea22b-7eda-45db-9881-2f3effaed26d" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="c7024bf5-4a27-4fa6-9d13-a764b3c28dad" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="07dfc4d0-70f1-4c5a-9bdf-45ec6f87db72" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>	
	<sub-flow name="client-create-order-shipment-call-ws-modificar-estado-guia-vmodal" doc:id="3c125474-25d6-4ac8-a219-ede9e8cc7b69" >
		<try doc:name="Try" doc:id="6ffc276c-718a-4776-8ddf-a96b5b85c013" >
			<wsc:consume doc:name="Consume" doc:id="59541091-d0c0-4f73-aac2-fad868eea839" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="ModificarEstadoGuia" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="9fd789bd-f842-4e10-9cc4-90f1ccac11a9" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT" >
					<ee:transform doc:name="Transform Message" doc:id="b7ef53d5-c462-49e5-be20-afba1b826d59" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="10993b87-c120-4863-ab20-96b74b9d54d2" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="7671f191-9ac2-4592-9376-4ff67e026cd8" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="29301392-af0c-4f83-9198-f02db106e123" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="client-create-order-shipment-call-ws-modificar-estado-viaje-vmodal" doc:id="01f9c74b-6c55-4926-8076-e119cbb39e64" >
		<try doc:name="Try" doc:id="6636fce6-fa6f-4fb7-a242-62b5ea3ea306" >
			<wsc:consume doc:name="Consume" doc:id="08eb5cfb-d3d2-48be-b4c8-19ef2f947237" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="ModificarEstadoViaje" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="ca316fc8-7072-4787-aa87-55dd4e012066" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT" >
					<ee:transform doc:name="Transform Message" doc:id="7ec6ca58-36a7-465a-b231-0394203fef08" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="b017f98e-5ee0-4706-b6a0-1b9377017a36" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="1d3edb75-3e53-4fef-8b25-9a1fc4f70743" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="53b6fd1b-cd8e-4e69-b4a0-dceefaf3656d" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="client-ws-unigis-vmodal-send-document-pdf-and-xml" doc:id="5ce5fb66-1bde-45d0-910b-c0f7055d633a" >
		<try doc:name="Try" doc:id="b3c2c217-6161-4f7d-99ae-b566b7d53c3e" >
			<wsc:consume doc:name="Consume" doc:id="60a801a4-d5c0-4a12-b616-a10cd27a1677" config-ref="TMS-UNIGIS-IMSS-Web_Service_Consumer_Config" operation="CrearDocumentos" />
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="fbc0476a-4890-43f2-b6e1-aa199264e4a7" type="WSC:CANNOT_DISPATCH, WSC:CONNECTIVITY, WSC:ENCODING, WSC:INVALID_WSDL, WSC:RETRY_EXHAUSTED, WSC:TIMEOUT" >
					<ee:transform doc:name="Transform Message" doc:id="a2ef1556-ca28-4a6f-a3d4-879400508f11" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="causeby" ><![CDATA[%dw 2.0
output application/json
---
error.description]]></ee:set-variable>
							<ee:set-variable variableName="main_error" ><![CDATA[%dw 2.0
output application/json
---
error.errorType]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<ee:transform doc:name="set payload error" doc:id="5f179b96-ad1b-4a24-82fa-8e28f20ddc47" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  traxion_response: {
    completed_succesfully: "false",
    error: {
      error_type: "TMS:" ++ (vars.main_error.identifier default "ERROR"),
      payload: {
      	event: correlationId
      },
      user_error_description: "error en comunicacion con TMS",
      system_error_description: vars.causeby
    }
  }
}]]></ee:set-payload>
						</ee:message>
						<ee:variables >
							<ee:set-variable variableName="slackChannel" ><![CDATA[%dw 2.0
output application/json
---
p('slack.connection.channel.connectivity.error')]]></ee:set-variable>
							<ee:set-variable variableName="messageProvider" ><![CDATA[%dw 2.0
output application/json
---
"ERROR PROVENIENTE DE TMS BLUEYONDER"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="orchestrator-send-message-to-slack-main" doc:id="60d1170f-2979-40bf-b900-412e011cc79d" name="orchestrator-send-message-to-slack-main" />
					<raise-error doc:name="Raise error" doc:id="cba3c2b6-bca1-4cba-b048-53a44dd9e31c" type="TMS:ERROR" description="#[vars.causeby]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>						
</mule>
